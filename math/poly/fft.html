<!DOCTYPE HTML>
<html lang="zh-cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FFT - ZAFU ACM Wiki</title>
        <!-- Custom HTML head -->
<style>
main p > code {
    color: #f14668 !important;
    background: unset  !important;
}

main pre > code {
    padding: 10px !important;
}

main p a, main ul a {
    color: #0099ff !important;
}

.katex-display {
    overflow: auto hidden;
}
</style>

<link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/KaTeX/0.13.16/katex.min.css">
<script defer src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/KaTeX/0.13.16/katex.min.js"></script>
<script defer src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/KaTeX/0.13.16/contrib/auto-render.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {

        delimiters: [
            { left: '$$', right: '$$', display: true },
            { left: '$', right: '$', display: false },
            { left: '\\(', right: '\\)', display: false },
            { left: '\\[', right: '\\]', display: true },
            {left: "\\begin{equation}", right: "\\end{equation}", display: true},
        ],
        macros: {
            "\\RR": "\\mathbb{R}",
            "\\NN": "\\mathbb{N}",
            "\\QQ": "\\mathbb{Q}",
            "\\ZZ": "\\mathbb{Z}",
            "\\CC": "\\mathbb{C}",
            "\\ee": "\\mathrm{e}",
            "\\dd": "\\mathrm{d}",
            "\\eps": "\\varepsilon",
        },
        globalGroup: true,
        throwOnError: false
    });
});
</script>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../docs/_static/extra.css">
        <link rel="stylesheet" href="../../theme/mdbook/mdbook-admonish.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> 介绍</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../about/support.html"><strong aria-hidden="true">1.1.</strong> 如何参与</a></li></ol></li><li class="chapter-item expanded "><a href="../../basic/index.html"><strong aria-hidden="true">2.</strong> 基础</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../basic/basic.html"><strong aria-hidden="true">2.1.</strong> 算法思想</a></li><li class="chapter-item "><a href="../../basic/example.html"><strong aria-hidden="true">2.2.</strong> 优化例题</a></li><li class="chapter-item "><a href="../../basic/divide.html"><strong aria-hidden="true">2.3.</strong> 递归</a></li><li class="chapter-item "><a href="../../basic/binary.html"><strong aria-hidden="true">2.4.</strong> 二分</a></li><li class="chapter-item "><a href="../../basic/greedy.html"><strong aria-hidden="true">2.5.</strong> 贪心</a></li><li class="chapter-item "><a href="../../basic/sort.html"><strong aria-hidden="true">2.6.</strong> 排序</a></li><li class="chapter-item "><a href="../../basic/recursion.html"><strong aria-hidden="true">2.7.</strong> 递推初步</a></li><li class="chapter-item "><a href="../../basic/dp.html"><strong aria-hidden="true">2.8.</strong> 动态规划</a></li><li class="chapter-item "><a href="../../basic/prefix-sum.html"><strong aria-hidden="true">2.9.</strong> 前缀和 & 差分</a></li><li class="chapter-item "><a href="../../basic/quick-pow.html"><strong aria-hidden="true">2.10.</strong> 快速幂</a></li><li class="chapter-item "><a href="../../basic/end.html"><strong aria-hidden="true">2.11.</strong> 结语</a></li></ol></li><li class="chapter-item expanded "><a href="../../math/index.html"><strong aria-hidden="true">3.</strong> 数学</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../math/sieve.html"><strong aria-hidden="true">3.1.</strong> 筛法</a></li><li class="chapter-item "><a href="../../math/crt.html"><strong aria-hidden="true">3.2.</strong> 中国剩余定理</a></li><li class="chapter-item "><a href="../../math/game-theory.html"><strong aria-hidden="true">3.3.</strong> 基础博弈</a></li><li class="chapter-item "><a href="../../math/dirichlet.html"><strong aria-hidden="true">3.4.</strong> Dirichlet 卷积</a></li><li class="chapter-item "><a href="../../math/multiplicative-function.html"><strong aria-hidden="true">3.5.</strong> 积性函数</a></li><li class="chapter-item expanded "><a href="../../math/poly/index.html"><strong aria-hidden="true">3.6.</strong> 多项式</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../math/poly/convolution.html"><strong aria-hidden="true">3.6.1.</strong> 卷积</a></li><li class="chapter-item expanded "><a href="../../math/poly/fft.html" class="active"><strong aria-hidden="true">3.6.2.</strong> FFT</a></li><li class="chapter-item "><a href="../../math/poly/newton.html"><strong aria-hidden="true">3.6.3.</strong> 牛顿迭代</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../struct/index.html"><strong aria-hidden="true">4.</strong> 数据结构</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../struct/fenwick-tree.html"><strong aria-hidden="true">4.1.</strong> 数据结构</a></li><li class="chapter-item "><a href="../../struct/sparse-table.html"><strong aria-hidden="true">4.2.</strong> ST 表</a></li></ol></li><li class="chapter-item expanded "><a href="../../string/index.html"><strong aria-hidden="true">5.</strong> 字符串</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../string/minimal-string.html"><strong aria-hidden="true">5.1.</strong> 最小表示法</a></li></ol></li><li class="chapter-item expanded "><a href="../../other/index.html"><strong aria-hidden="true">6.</strong> 附录</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../other/markdown.html"><strong aria-hidden="true">6.1.</strong> Markdown 简介</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZAFU ACM Wiki</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/zafuacm/wiki/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/zafuacm/wiki/edit/main/docs/math/poly/fft.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fft"><a class="header" href="#fft">FFT</a></h1>
<p>前置知识：复数、原根、卷积。</p>
<p>对于 $n$ 次多项式</p>
<p>$$
\begin{aligned}
f(x) = \sum_{i=0}^n f_ix^i &amp;=  f_0 + f_1 x + f_2x^2 + \cdots + g_nx^n \\
g(x) = \sum_{i=0}^n g_ix^i &amp;=  g_0 + g_1 x + g_2x^2 + \cdots + g_nx^n
\end{aligned}
$$</p>
<p>它们的乘法是 $F(x) = f(x)g(x) = \sum\limits_{k=0}^{2n} c_kx^k$，其中</p>
<p>$$
c_k = \sum_{i+j=k}f_ig_j
$$</p>
<p>因此计算多项式的乘积需要 $n^2$ 次系数乘法，我们需要优化。</p>
<h2 id="点值表示法"><a class="header" href="#点值表示法">点值表示法</a></h2>
<p>$n$ 次多项式 $f(x)$ 可以由 $n+1$ 个系数决定，也可以由 $n+1$ 个座标（点值）决定。即 $n$ 次多项式可以看作 $n+1$ 维的向量。</p>
<p>考虑选取 $2n+1$ 个座标来确定 $f(x)$ 和 $g(x)$。则 $F(x)$ 可以简单的通过做 $2n+1$ 次乘法得到</p>
<p>$$
(x_k,F(x_k)) = \left(x_k, f(x_k)g(x_k)\right)
$$</p>
<p>于是求多项式的乘法，可以先从系数表示法转换为点值表示法，做完乘法再变回去。</p>
<h2 id="单位原根"><a class="header" href="#单位原根">单位原根</a></h2>
<p>称方程 $x^n = 1$ 的 $n$ 个解为单位根，其中特殊的一个记作 $\omega_n = e^{\frac{2 \pi i}{n}}$，称为单位原根。根据 Euler 公式，有</p>
<p>$$
\omega_n = e^{\tfrac{2 \pi i}{n}} = \cos \left(\frac{2\pi}{n}\right) + i \sin \left(\frac{2\pi}{n}\right)
$$</p>
<p>即 $\omega_n$ 是单位圆上的一个点，全部的 $n$ 个单位根</p>
<p>$$
x_k = \omega_n^k = e^{k\tfrac{2 \pi i}{n}} = \cos \left(\frac{2\pi k}{n}\right) + i \sin \left(\frac{2\pi k}{n}\right) 
$$</p>
<p>恰全是单位元的 $n$ 等分点。因此根据 Euler 公式，<strong>单位根之间的乘法就是在单位元上转圈圈。</strong></p>
<h2 id="dft"><a class="header" href="#dft">DFT</a></h2>
<p>设多项式 $f(x) = \sum\limits_{k=0}^{n-1} f_kx^k$，并记 $\omega = \omega_n$，则称向量</p>
<p>$$
\operatorname{DFT}_{\omega}(f) =( f(1), f(\omega^1), \cdots, f(\omega^{n-1}) )
$$</p>
<p>为 $f$ 的离散 Fourier 变换（DFT）。</p>
<p>DFT 存在逆变换（IDFT），即从点值重新变回系数，仍是从向量到向量的变换。</p>
<p>IDFT 存在性质</p>
<p>$$
(\operatorname{DFT}_{\omega})^{-1} = \frac{1}{n} (\operatorname{DFT}_{\omega^{-1}})
$$</p>
<p>篇幅所限，不放证明。现在我们可以统一的处理 DFT 和 IDFT。</p>
<h2 id="分治"><a class="header" href="#分治">分治</a></h2>
<p>利用单位元根的特殊性，我们可以分治计算 DFT。比如对于 $7$ 次多项式</p>
<p>$$
\begin{aligned}
f(x) &amp;= f_0 + f_1x + f_2x^2 + f_3 x^3 + f_4 x^4 + f_5 x^5 + f_6 x^6 + f_7 x^7 \\
&amp;= (f_0 + f_2x^2 + f_4x^4 + f_6x^6) + x(f_1 + f_3x^2 + f_5x^4 + f_7x^6)
\end{aligned}
$$</p>
<p>奇偶分别建立函数</p>
<p>$$
\begin{aligned}
f^{[0]}(x) &amp;= f_0 + f_2x + f_4x^2 + f_6x^3 \\
f^{[1]}(x) &amp;= f_1 + f_3x + f_5x^2 + f_7x^3
\end{aligned}
$$</p>
<p>则原来的函数可以表示为</p>
<p>$$
f(x) = f^{[0]}(x^2) + xf^{[1]}(x^2)
$$</p>
<p>一般的，对于度小于 $n$ 的多项式 $f(x)$，利用单位原根的性质有</p>
<p>$$
\begin{aligned}
f(\omega_{n}^k) &amp;= f^{[0]}(\omega_{n}^k \cdot \omega_{n}^k) + \omega_{n}^kf^{[1]}(\omega_{n}^k \cdot \omega_{n}^k) \\
&amp;= f^{[0]}(\omega_{n}^{2k}) + \omega_{n}^kf^{[1]}(\omega_{n}^{2k}) \\
&amp;= f^{[0]}(\omega_{n/2}^{k}) + \omega_{n}^kf^{[1]}(\omega_{n/2}^{k})
\end{aligned}
$$</p>
<p>同理可得</p>
<p>$$
\begin{aligned}
f(\omega_{n}^{k+n/2}) &amp;= f^{[0]}(\omega_{n}^{2k+n}) + \omega_{n}^{k+n/2}f^{[1]}(\omega_{n}^{2k+n}) \\
&amp;= f^{[0]}(\omega_{n/2}^{k}) - \omega_{n}^{k}f^{[1]}(\omega_{n/2}^{k})
\end{aligned}
$$</p>
<p>因此我们需要把多项式的系数向上补到 $2^n$ 个，方便分治。</p>
<p>在 DFT 中使用有</p>
<p>$$
\begin{aligned}
\operatorname{DFT}_{\omega}(f)[j] &amp;= \operatorname{DFT}_{\omega^2}(f^{[0]})[j] + \omega^j\operatorname{DFT}_{\omega^2}(f^{[1]})[j] \\
\operatorname{DFT}_{\omega}(f)[j + n/2] &amp;= \operatorname{DFT}_{\omega^2}(f^{[0]})[j] - \omega^j\operatorname{DFT}_{\omega^2}(f^{[1]})[j]
\end{aligned}
$$</p>
<p>至此，我们可以写出递归版的 FFT。</p>
<pre><code class="language-cpp">void DFT(Comp *f, int n, int type) {
    if (n == 1)
        return;
    for (int i = 0; i &lt; n; i++)
        tmp[i] = f[i];
    for (int i = 0; i &lt; n; i++) {  // 偶数放左边，奇数放右边
        if (i &amp; 1)
            f[n / 2 + i / 2] = tmp[i];
        else
            f[i / 2] = tmp[i];
    }
    Comp *g = f, *h = f + n / 2;
    DFT(g, n / 2, type), DFT(h, n / 2, type);
    Comp step(cos(2 * PI / n), sin(2 * PI * type / n));
    Comp cur(1, 0);

    for (int k = 0; k &lt; n / 2; k++) {
        tmp[k] = g[k] + cur * h[k];
        tmp[k + n / 2] = g[k] - cur * h[k];
        cur = cur * step;
    }
    for (int i = 0; i &lt; n; i++)
        f[i] = tmp[i];
}
</code></pre>
<h2 id="蝴蝶变换"><a class="header" href="#蝴蝶变换">蝴蝶变换</a></h2>
<p>递归分治总是不尽人意的，如果能一次到位就更好了。还是以 $7$ 次多项式为例</p>
<ul>
<li>初始 $\{x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7\}$</li>
<li>一次 $\{x^0,x^2,x^4,x^6\},\{x^1,x^3,x^5,x^7\}$</li>
<li>两次 $\{x^0,x^4\},\{x^2,x^6\},\{x^1,x^5\},\{x^3,x^7\}$</li>
<li>结束 $\{x^0\},\{x^4\},\{x^2\},\{x^6\},\{x^1\},\{x^5\},\{x^3\},\{x^7\}$</li>
</ul>
<p>写出二进制的形式，可以发现规律</p>
<p>$$
\begin{matrix}
\text{初始}    &amp; 0    &amp; 1    &amp; 2    &amp; 3    &amp; 4    &amp; 5    &amp; 6    &amp; 7    &amp;\\
\text{初始(2)} &amp; 000  &amp; 001  &amp; 010  &amp; 011  &amp; 100  &amp; 101  &amp; 110  &amp; 111  &amp;\\
\text{结束(2)} &amp; 000  &amp; 100  &amp; 010  &amp; 110  &amp; 001  &amp; 101  &amp; 011  &amp; 111  &amp;\\
\text{结束}    &amp; 0    &amp; 4    &amp; 2    &amp; 6    &amp; 1    &amp; 5    &amp; 3    &amp; 7    &amp;
\end{matrix}
$$</p>
<p>结束和开始的二进制恰好是相反的。这个变换称为蝴蝶变换，也称位逆序置换（bit-reversal permutation）。</p>
<p>我们可以 $O(n)$ 的预处理出变换数组。设 <code>R(x)</code> 是 $x$ 的变换结果，则 <code>R(x&gt;&gt;1)</code> 是已求的。</p>
<p>$$
\begin{aligned}
\texttt{000abcd} &amp;\to \texttt{dcba000} \\
\texttt{00abcdx} &amp;\to \texttt{xdcba00}
\end{aligned}
$$</p>
<p>即是把 <code>R(x&gt;&gt;1)</code> 右移一位再补上最高位即可。代码如下</p>
<pre><code class="language-cpp">int lim = 1, lim_2;
while (lim &lt;= n + m)
    lim &lt;&lt;= 1;
lim_2 = lim &gt;&gt; 1;
for (int i = 0; i &lt; lim; ++i) {
    rev[i] = rev[i &gt;&gt; 1] &gt;&gt; 1;
    if (i &amp; 1)
        rev[i] |= lim &gt;&gt; 1;
    // 或者合并写为
    // rev[i] = (rev[i &gt;&gt; 1] &gt;&gt; 1) | ((i &amp; 1) * lim_2);
}
</code></pre>
<p>现在我们可以写出非递归版的 FFT。</p>
<pre><code class="language-cpp">void FFT(Comp *f, int n, int type) {
    for (int i = 0; i &lt; n; ++i) {
        if (i &lt; rev[i]) {
            swap(f[i], f[rev[i]]);
        }
    }
    for (int h = 2; h &lt;= n; h &lt;&lt;= 1) {
        Comp step(cos(2 * PI / h), sin(2 * PI * type / h));
        for (int j = 0; j &lt; n; j += h) {
            Comp cur(1, 0);
            for (int k = j; k &lt; j + h / 2; k++) {
                Comp f1 = f[k], f2 = f[k + h / 2];
                f[k] = f1 + cur * f2;
                f[k + h / 2] = f1 - cur * f2;
                cur = cur * step;
            }
        }
    }
    if (type == 1)
        return;
    for (int i = 0; i &lt; n; i++)
        f[i].x /= n, f[i].y /= n;
}
</code></pre>
<h2 id="三步并做两步"><a class="header" href="#三步并做两步">三步并做两步</a></h2>
<p>实战一下：<a href="https://www.luogu.com.cn/problem/P3803">P3803 多项式乘法</a>。</p>
<p>我们的计算步骤是：</p>
<pre><code class="language-cpp">FFT(F, lim, 1);
FFT(G, lim, 1);
for (int i = 0; i &lt;= lim; i++)
    F[i] = F[i] * G[i];
FFT(F, lim, -1);
</code></pre>
<p>实际上，我们并不用三次 FFT，两次足以。注意到若把 $F(x)$ 放在实部而 $G(x)$ 放在虚部</p>
<p>$$
(F + iG)^2 = (F^2-G^2) + 2iFG
$$</p>
<p>平方之后虚部恰是答案。</p>
<h2 id="无-rev"><a class="header" href="#无-rev">无 REV</a></h2>
<p>实际上 REV 是可以消掉的，完全的推导比较复杂，这里只是以板子的形式给出。</p>
<pre><code class="language-cpp">template &lt;class iter&gt;
void ntt(iter f, int n) {
    pre_w(n), ntt_size += n;
    for (int l = n / 2; l; l &gt;&gt;= 1)
        for (int i = 0; i &lt; n; i += l * 2)
            for (int j = 0; j &lt; l; j++) {
                int x = f[i + j], y = f[i + j + l];
                f[i + j + l] = 1ll * (x - y + P) * w[j + l] % P;
                f[i + j] = mo(x + y);
            }
}

template &lt;class iter&gt;
void intt(iter f, int n) {
    pre_w(n), ntt_size += n;
    for (int l = 1; l &lt; n; l &lt;&lt;= 1)
        for (int i = 0; i &lt; n; i += l * 2)
            for (int j = 0; j &lt; l; j++) {
                int x = f[i + j];
                int y = 1ll * w[j + l] * f[i + j + l] % P;
                f[i + j] = mo(x + y), f[i + j + l] = mo(x - y + P);
            }
    const int iv = qpow(n);
    for (int i = 0; i &lt; n; i++)
        f[i] = 1ll * f[i] * iv % P;
    reverse(f + 1, f + n);
}
</code></pre>
<h2 id="应用"><a class="header" href="#应用">应用</a></h2>
<p>FFT 是卷积计算的基础工具。更多应用见 <a href="../convolution/">卷积</a>。</p>
<h2 id="练习"><a class="header" href="#练习">练习</a></h2>
<ul>
<li><a href="https://www.luogu.com.cn/problem/P3803">P3803 多项式乘法</a></li>
</ul>
<h2 id="参考资料"><a class="header" href="#参考资料">参考资料</a></h2>
<ul>
<li><a href="https://oi-wiki.org/math/poly/fft/">快速傅里叶变换 - OI Wiki</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../math/poly/convolution.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../math/poly/newton.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../math/poly/convolution.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../math/poly/newton.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
